package com.hcmus.site.security;

@Service
public class CaptchaService {
    private static final String RECAPTCHA_VERIFY_URL = "https://www.google.com/recaptcha/api/siteverify";
    private final String secretKey = "YOUR_SECRET_KEY";

    public boolean validateCaptcha(String captchaToken) {
        RestTemplate restTemplate = new RestTemplate();
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
        
        MultiValueMap<String, String> requestBody = new LinkedMultiValueMap<>();
        requestBody.add("secret", secretKey);
        requestBody.add("response", captchaToken);
        
        HttpEntity<MultiValueMap<String, String>> request = new HttpEntity<>(requestBody, headers);
        
        ResponseEntity<Map> response = restTemplate.postForEntity(RECAPTCHA_VERIFY_URL, request, Map.class);
        Map<String, Object> body = response.getBody();
        
        if (body != null && body.containsKey("success")) {
            Boolean success = (Boolean) body.get("success");
            if (success) {
                Double score = (Double) body.get("score");
                return score >= 0.5; // Set the threshold as needed
            }
        }
        return false;
    }
}
