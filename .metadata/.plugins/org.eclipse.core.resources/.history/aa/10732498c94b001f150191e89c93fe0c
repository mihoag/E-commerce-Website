<!DOCTYPE html>
<html xmlns:th = "http://www.thymeleaf.org">
<head th:replace="fragment :: html_file" />
<body style="background-color: #f5f7f6;">
   <!-- Header -->
   <div th:replace="fragment :: header"></div>

    <div class="container-fluid w-100 mt-2">
       
        <div class="row w-100">
            <div class="col-md-3">
               <!-- start side bar -->
               <aside th:replace="fragment :: sidebar"></aside>
               <!--end side bar-->
            </div>
            
            <div class="col-md-9">
            <div id = "manageTitle" class = "d-flex justify-content-center"><h3>Manage Users</h3></div>
            
            <!--Body table student-->
               <main class="main-content border-radius-lg">
                    <div class="card mt-3">
                     <form class="d-flex mx-2 my-2" method="POST" >
                      <input class="form-control me-1" type="search" placeholder="Enter the keyword"> 
                      <button class="btn btn-primary"  style="width: 150px;" type="submit">Search</button>
                     </form>
                     <div class= "d-flex" id = "functionButtons">
                        <a th:href="@{/users/new}"
                            class="btn btn-primary mt-3 mx-3" >Create new user</a>
                        <a th:href="@{/users/export/csv}" type="button"
                             class="btn btn-primary mt-3 mx-3" >Export to CSV</a>
                        <a th:href="@{/users/export/pdf}"
                            class="btn btn-primary mt-3 mx-3" >Export to PDF</a>
                        <a th:href="@{/users/export/excel}" type="button"
                            class="btn btn-primary mt-3 mx-3" >Export to EXCEL</a>
                    </div>
                        <!-- Table  -->
                        <div class="card-body px-0 pb-2">
                            <div class="table-responsive p-0">
                                <table class="table align-items-center mb-0">
                                    <thead>
                                        <tr>
                                            <th>
                                                <i th:if="${sortDir eq 'asc' and sortField eq 'id'}" class="fa-solid fa-arrow-up"></i>
                                                <i  th:if="${sortDir eq 'desc' and  sortField eq 'id'}" class="fa-solid fa-arrow-down"></i>
                                               <a style="text-decoration: none;" class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" th:href="@{'/users/page/' + ${currentPage} + '?sortField=id&sortDir=' + ${reverseSortDir}}">User ID</a> 
                                               </th>
                                   
                                            <th>
                                               <i th:if="${sortDir eq 'asc' and sortField eq 'email'}" class="fa-solid fa-arrow-up"></i>
                                               <i  th:if="${sortDir eq 'desc' and  sortField eq 'email'}" class="fa-solid fa-arrow-down"></i>
                                               <a style="text-decoration: none;" class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" th:href="@{'/users/page/' + ${currentPage} + '?sortField=email&sortDir=' + ${reverseSortDir}}">Email</a> 
                                               </th>
                                            <th>
                                               <i th:if="${sortDir eq 'asc' and sortField eq 'firstName'}" class="fa-solid fa-arrow-up"></i>
                                                <i  th:if="${sortDir eq 'desc' and  sortField eq 'firstName'}" class="fa-solid fa-arrow-down"></i>
                                               <a style="text-decoration: none;" class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" th:href="@{'/users/page/' + ${currentPage} + '?sortField=firstName&sortDir=' + ${reverseSortDir}}">First Name</a> 
                                               </th>
                                            <th>
                                                <i th:if="${sortDir eq 'asc' and sortField eq 'lastName'}" class="fa-solid fa-arrow-up"></i>
                                                <i  th:if="${sortDir eq 'desc' and  sortField eq 'lastName'}" class="fa-solid fa-arrow-down"></i>
                                               <a style="text-decoration: none;" class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7" th:href="@{'/users/page/' + ${currentPage} + '?sortField=lastName&sortDir=' + ${reverseSortDir}}">Last Name</a> 
                                               </th>
                                             <th
                                                class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">
                                                Roles</th>
                                             <th
                                                class="text-uppercase text-secondary text-xxs font-weight-bolder opacity-7 ps-2">
                                                Enabled</th>
                                            <th class="text-secondary opacity-7"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="user : ${listUsers}">
                                            <td>
                                                <div class="d-flex px-4 py-1">
                                                    <div class="d-flex flex-column justify-content-center">
                                                        <h6 class="mb-0 text-sm" th:text="${user.id}"></h6>
                                                    </div>
                                                </div>
                                            </td>
                                          
                                            <td>
                                                <p class="text-xs font-weight-bold mb-0" th:text="${user.email}"></p>
                                            </td>
                                            <td>
                                                <p class="text-xs font-weight-bold mb-0" th:text="${user.firstName}">
                                                </p>
                                            </td>
                                            <td>
                                                <p class="text-xs font-weight-bold mb-0" th:text="${user.lastName}">
                                                </p>
                                            </td>
                                            <td>
                                                <p class="text-xs font-weight-bold mb-0" >[[${user.roles}]]
                                                </p>
                                            </td>
                                            <td>
                                               <div class="d-flex flex-column justify-content-center">
                                                  <a th:href="@{'/users/user/' + ${user.id} + '/enabled/false'}" th:if="${user.enabled}"  class="fa-solid fa-circle-check"></a>
                                                  <a th:href="@{'/users/user/' + ${user.id} + '/enabled/true'}" th:unless ="${user.enabled}" class="fa-solid fa-ban"></a>
                                               </div>
                                            </td>
                                            <td>
                                                <a href="javascript:;" class="text-secondary font-weight-bold text-xs"
                                                   data-toggle="tooltip" data-bs-toggle="modal"  th:attr="data-id=${user.id}"
                                                   data-bs-target="#detailUser">Detail User
                                                </a>
                                                &nbsp;
                                                <a href="javascript:;" class="text-secondary font-weight-bold text-xs"
                                                   data-toggle="tooltip" data-bs-toggle="modal" th:attr="data-id=${user.id}"
                                                   data-bs-target="#deleteUser">
                                                    Delete
                                                </a>
                                                &nbsp;
                                                <a class="text-secondary font-weight-bold text-xs"
                                                 th:href="@{/users/edit/} + ${user.id}">
                                                    Update
                                                </a>
                                            </td>
                                      
                                        </tr>
                                    </tbody>
                                </table>
                               
                                <!-- Pagination -->
                                  <nav aria-label="..." style="margin: 2% 0 0 1%;" th:if="${totalPages > 1}">
                                    <ul class="pagination">
                           
                                        <li class="page-item disabled">
                                            <span th:unless="${currentPage > 1}" class="page-link">First</span>
                                        </li>
                                        <li th:if="${currentPage > 1}"  class="page-item"><a class="page-link" th:href="@{/users/page/1 + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}}">First</a></li>
                                    
                                    
                                        <li class="page-item disabled">
                                            <span th:unless="${currentPage > 1}" class="page-link">Previous</span>
                                        </li>
                                        <li th:if="${currentPage > 1}"  class="page-item"><a class="page-link" th:href="@{'/users/page/' + ${currentPage - 1}  + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}}">Previous</a></li>
                                        
                                        <div th:each="i: ${#numbers.sequence(1, totalPages)}">
			                            <li th:if="${currentPage != i}" class="page-item"><a th:href="@{'/users/page/' + ${i}  + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}}" class="page-link" href="#">[[${i}]]</a></li>
                                        <li th:unless="${currentPage != i}" class="page-item active" aria-current="page">
                                            <span class="page-link">[[${i}]]</span>
                                        </li>
		    
                                        </div>
                                        <li class="page-item disabled">
                                            <span th:unless="${currentPage < totalPages}" class="page-link">Next</span>
                                        </li>
                                        <li th:if="${currentPage < totalPages}" class="page-item"><a class="page-link" th:href="@{'/users/page/' + ${currentPage + 1} + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}}">Next</a></li>
                                   
                                         <li class="page-item disabled">
                                            <span th:unless="${currentPage < totalPages}" class="page-link">Last</span>
                                        </li>
                                        <li th:if="${currentPage < totalPages}" class="page-item"><a class="page-link" th:href="@{'/users/page/' + ${totalPages}  + '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir} }">Last</a></li>
                                    </ul>
                                </nav>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>
     <div th:replace="fragment :: footer"></div>
     
     <!-- Toast Container -->
    <div class="toast-container">
        <!-- Toast HTML -->
        <div class="toast" id="successToast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="mr-auto">Info</strong>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="toast-body" id = "message">[[${message}]]</div>
        </div>
    </div>
     
    
     <!-- Modal dialog detail User-->
    <div class="modal fade" id="detailUser" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Detail User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body">
                    <div class="col-auto d-flex justify-content-center">
               
                        <img id = "detailPhoto" src = "https://th.bing.com/th/id/OIP.QjynegEfQVPq5kIEuX9fWQHaFj" alt="Example Image" style="width: 100px" class="img-fluid">
                    </div><hr>
                    <div class="col-auto">
                        <label>User ID</label>
                        <p id="detailId">1</p>
                    </div>
                    <hr>
                    <div class="col-auto">
                        <label>Email</label>
                        <p id="detailEmail">leminhhoang12345le@gmail.com</p>
                    </div>
                    <hr>
                    <div class="col-auto">
                        <label>Fullname</label>
                        <p id="detailName">Le Minh Hoang</p>
                    </div>
                    <hr>
                    <div class="col-auto">
                        <label>Roles</label>
                        <p id="detailRole"></p>
                    </div>
                    <hr>
                    <div class="col-auto">
                        <label>Enabled</label>
                        <p id="detailEnabled">True</p>
                    </div>
                    
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!--Modal dialog delete User-->
    <div class="modal fade" id="deleteUser" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Delete User</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                   Are you sure to delete this user?
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button id="buttonDelete" type="button" class="btn btn-primary">Delete</button>
                </div>
            </div>
        </div>
    </div>
    
    
     
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script type="text/javascript" th:src="@{/js/ConfigViewEvent.js}"></script>
     <script type="text/javascript" th:src="@{/js/user/ConfigViewUserEvent.js}"></script>
    
</body>
</html>